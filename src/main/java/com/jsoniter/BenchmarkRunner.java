package com.jsoniter;


import com.dslplatform.json.DslJson;
import org.openjdk.jmh.Main;
import org.openjdk.jmh.annotations.*;
import org.openjdk.jmh.infra.Blackhole;

import java.io.IOException;

@State(Scope.Thread)
public class BenchmarkRunner {

    private DslJson dslJson;
    private byte[] input;
    private Jsoniter iter;
    private TypeLiteral<Users> typeLiteral;

    @Setup(Level.Trial)
    public void init() throws IOException {
        dslJson = new DslJson();
        iter = Jsoniter.parse(new byte[0]);
        input = "{'users':[{'_id':'33317288154329207598','index':2066111337,'guid':'FUhvyUbkGNdVKtg8vtM3','isActive':false,'balance':'Kzf7xZZNMU2fPdVA9cI5','picture':'AB9bci6CRPeahBinzeJCgRSLoqTWzBE9vhhIRAzbD7hMlb9RDunBXwtiu51qKNHE5VNYubxnq8o2TY4ixd3oudEjolLvzB8eLMn2','age':97,'eyeColor':'S39lBrpWvOQDQTxcrTG8','name':'rfMaxEwEopb1FBwx8ijh','gender':'53sJptPv19tLreFDtkJe','company':'Ji1pU6ZKTckhVUweO1DN','email':'s23rs3zON7Cr18PGprul','phone':'j3e78gyM0r5UXVhmXmYU','address':'eOt01Y9A2FOl5xNLcrbz','about':'kdPRo0HA0pvZpVCQRHWM','registered':'W5x6b9QB2u9kABLgvPI4','latitude':49.944371857516536,'longitude':118.04006511580518,'tags':['TCwhhndb0L','RYhqqaVOhP','pC8i94rJpQ'],'friends':[{'id':'5657','name':'ruEjnZVesTiActQGXObQDUVMrfRHfW'},{'id':'3914','name':'ENJsounGiQmlNieexEmzgmBljpeziU'},{'id':'4669','name':'TduQeArCWidKVjhYqoezJqaAstrlfV'}],'greeting':'KMTfVDDueNY77gAPzuHl','favoriteFruit':'Vx95iYAdLfih3MVII1qn'},{'_id':'83544061025009628960','index':1157013448,'guid':'Uv04OFFnudErbQef2VPo','isActive':true,'balance':'DEN1uK1irRTA5yQY6wxm','picture':'hD7Y97xKOLXYhiC8y7URe6cnJbfFbQ3Cz6hTQCNOQDcGlewLFTufu6NUTTlQOryvF41c8NEsTE3SqgJvCFUWyXTqafBmaK9gZUiF','age':79,'eyeColor':'LmaQjMM3cPtWQ1Y5Vb5w','name':'HVhKlFEaAZTUwzKhBrnz','gender':'EgqAQw1Iy8dtMn52ugZt','company':'2rXGRwEvlKlK9FYsPgcW','email':'lNbUY3Re3yheziLSHa48','phone':'W8OOGn93kh1KpM7G3hqy','address':'qXJDC5BwVB50VfyesxyJ','about':'1GadvD54N8ZzsIy5rPqz','registered':'5ArcJPMVJoSpsw26gCuq','latitude':83.86848442737045,'longitude':125.81577172022023,'tags':['S9nDyyJQkl','96Qqv7vXSU','w7aldSiBjh'],'friends':[{'id':'1366','name':'YjHZmdrCjQuhFyfKDTzIoiGqDxwiEA'},{'id':'933','name':'KSqJOKYHnVXsDzZGiLSgaMQHHRhHEu'},{'id':'6743','name':'LrdOBjMviZQqQZNgCXSKukWbpQssMu'}],'greeting':'6snGR5fsv4Np1CrbXV4Z','favoriteFruit':'1MkxTLFapzi1S8kpFyiQ'},{'_id':'23409414291249068718','index':245413847,'guid':'OgdJ93qUp7WfXiVzgMLG','isActive':false,'balance':'dINkgDOiSOkPlMx96R3Q','picture':'AGTQ38xmBImyjgOH6z8rMjc917iLURAKipQ5iRNeMx29lEfdEyuPzpwI2zmgqP7ak19yQzYyPj95r0g5pE15UsEHPvDObtOdZxmy','age':52,'eyeColor':'NdtIxoUB0plaPyIINWCr','name':'qBNa00Q7BqiZJKbxTMKh','gender':'uwTkrdECyk9SbfTkT5FT','company':'X6ywi41Z5jgOH6NPtcjk','email':'l1YavqSCcnZDSDes8IDc','phone':'733QUyrXZw481YwZsMAu','address':'u63Wt9emupyTslbpyhlT','about':'J7sXgYs1R2ALNncEWeST','registered':'q2szVlqlq18h9INStEv0','latitude':55.59415027476521,'longitude':144.89927972251303,'tags':['kufecyvdFQ','U6K2S4Jou6','R1Pucrts9d'],'friends':[{'id':'4575','name':'xORcxxxUtBrejnDFmXoMZZBeAZEiNq'},{'id':'5787','name':'pIwrnUTWiHvRCWhIhhcxpxePnExfDU'},{'id':'3045','name':'TuGXTnoaxfjRhoqavHhXaoMjtybpmK'}],'greeting':'613Px17KH1rFpX6Y6R7p','favoriteFruit':'Am1mxSs6KB3oFp1A0FQF'},{'_id':'35442096021797332537','index':1381773216,'guid':'8uzNyoXGdlp0N0qf3Ufa','isActive':false,'balance':'SLvCFSPebtXV3c5DlqQT','picture':'8sjyPhV1PdoApu3yYDZHDPpvkjpdB7qr6Z5Ux0cC4sj1yHmkeaWeLTL1hMmsWt8dcNciLiHO1iShuDDM8A9oIMzcKOCsf8anznxP','age':58,'eyeColor':'NSYVyWlMQQNWyaGBsgeO','name':'36RHftNb8ZnGYbNrxK0x','gender':'qrgRl389kYWdibm9tCMS','company':'SrSvKDOMOw9GH9ghUL1Q','email':'60cfwxZe0JzBuKCvWSzs','phone':'iMzhNbAJGgbJuW2BMlA8','address':'QwSypuqFZllqo3r3hr31','about':'eR73GIzDhNRWs2wPf1K7','registered':'V7yJZT3rx1O064ZrJVRx','latitude':86.83374288816252,'longitude':28.75345055264345,'tags':['akS3aTM1zt','u0LFqqPV2I','O6O7mU5uN7'],'friends':[{'id':'9433','name':'AYzTYeKnnqdkmYIzZLwzjDygvTlLbm'},{'id':'8622','name':'jlKHmykdWluSHqrBpCXRYdcfHVHkib'},{'id':'1090','name':'djjZxidqTRnCGgtlQCEykOgRoFgIal'}],'greeting':'7qDUmtr6dXm3JInftIeu','favoriteFruit':'3b2HOYojTj1L4OSELWmq'},{'_id':'09343733779269329724','index':1779138351,'guid':'N0DJDL4VlxC5HJJheJA6','isActive':true,'balance':'sUfztKnPHZLqidlM6aZu','picture':'qNzyE26eGpnLpqkef9Bc7bVhDPRqm5XnswoiEeTqWdNvWZH8ypDZRW9cOBpSstL2s04W84o40xeYQIDK6Z4gRUyhMQ0qImbmqYDO','age':8,'eyeColor':'nFbv0PhogHnneWC5LLMk','name':'o8BVb8o2gl2VooCaYM3D','gender':'iKy5Bug13PekwlxxZOzH','company':'zCZwUclkdfISxmGFdMAU','email':'NxqZYMfIw62PeddXOyoC','phone':'D1tKDrmU6z0nvXM44a2Q','address':'ym0OtlZitBT3BWKiZrr4','about':'p0FRfFoDcpcyTO7OZtTT','registered':'Fqk2mtTWKsMH66b5DKcr','latitude':10.886263911091364,'longitude':32.69677058867348,'tags':['2LoalLSxPM','B8BNx8967I','hEJxTvifw4'],'friends':[{'id':'6070','name':'UKHivamSBBBKzDLevwmazvKgzrgLKk'},{'id':'1296','name':'XcwRqwsoqoEFmEwtsBZkGLjUTJHHUX'},{'id':'8862','name':'NbYdUCJzHTuHVAFZrzHzzBQBMwfWJB'}],'greeting':'hFbFGu8uuePw4GXZsKms','favoriteFruit':'rvr3BPaUajBwl2PMkjxp'},{'_id':'99607632274062500789','index':1255554370,'guid':'zF6Q6KH5tpBrqGMQ1zdp','isActive':false,'balance':'3ixRrP86DpdgUDy9237Q','picture':'wAtmKrCCr1lhxlR0N5bI0XDnxknbVmTmaQTDCI5512i32ytGIJe5J0Xkj41bhnS9rp8vneMfi5DmHQHrhczvhH57VvmOWJ4JfBVo','age':62,'eyeColor':'bQ41R4FnkhO38tERE5yg','name':'U7LyUupy7ThgQYijEfwS','gender':'k4hv4QYi5UviME85ZwI3','company':'v0o6PQONAbkZNRT8zUsN','email':'31nNyvCxCRO4CKV7ivpt','phone':'bxhvzJJDPNMh3MqebSLH','address':'7iFJ8f9VEUekOtlWvy5W','about':'mzXxQTOkMeMJr0gQgXzh','registered':'Egnr4A9exbW2w6LkzsV1','latitude':27.68355952849038,'longitude':67.17674709681037,'tags':['lopMfiGuKH','ITKMaJnJHx','JbofLJkXTJ'],'friends':[{'id':'894','name':'oorwIbVgDYFnyGdmuJaHyzPMpHVugR'},{'id':'7187','name':'cXDXTXImXbLhzBWluzuHxVRBBgRWTp'},{'id':'5634','name':'uHJlNYUfoSETZPbJUKrtqOTFfkrWRI'}],'greeting':'mezH2QYDRIzuvOlr8fH6','favoriteFruit':'MpQf7uadWO5pRGMB2Oiw'},{'_id':'60313270857399043899','index':1558852246,'guid':'aeCwTUv4BzLUQcpxcsGM','isActive':false,'balance':'QgajysW6l5YKkCqzK71Y','picture':'FTPdkidM3WYkeEjqCjOdBTZ6DfznvWazFlylznyctPYvmsZRxfwOp2q6nhH1ARVJCs40spgtYJtz0E2HLZyn83EbdLHQrPJQAywV','age':7,'eyeColor':'1wTjsQ1eR7iK34klrvrL','name':'2sGlvQa1Tv9HnLAFyoYG','gender':'c5CJLYFj5inp296sLxop','company':'hPAlEBRAvFKNATBJnpRn','email':'O9jrscVtsagDZaeFUWEL','phone':'M1wWo3iS4RwmCKBcr0Qs','address':'pjRXJlRQeyrPeh0ckUJL','about':'QlNVYT4SkTKwYxsXfe0p','registered':'llhYmstiYlBniu29Nldk','latitude':21.293165536710866,'longitude':156.70237808806033,'tags':['pqm6gWsKDs','rntbCzHGtT','1slKiyf1vy'],'friends':[{'id':'565','name':'XvllMnVegsckSiojzxulZFnRdzXHdz'},{'id':'6355','name':'AxiXdXHnVPyxeiAresrQdmcYszYaKP'},{'id':'1847','name':'bsDiAGVAXWhlJnfeCtjtQFaNaolvvT'}],'greeting':'hQbD3AUnkS5Urscs2DXi','favoriteFruit':'TlJ514iAKg9uzR9AEuVU'},{'_id':'56019517244760794537','index':1882155992,'guid':'lon1heisMZeYcqPzs2zi','isActive':false,'balance':'2v6MdLsivBKMizzVcCpw','picture':'1SOJcgxqEtzOEKEPYBEUxhkqT82qImHSlomDOQ9PzEBBrqV0ASE2likoz6bzRt33Vd7hFqfZRvrt0rk4tjuR7XAmda858cx9QRar','age':90,'eyeColor':'pH8Ux6WdzUDQ5eI0tyUm','name':'AGI6HdYOug1JwEdP2zqQ','gender':'YQUbDPJ4DKKWDMSQiroJ','company':'3QcYKUMyuMVtcv4sZWIY','email':'LqhzwjDkdXsQ1kf10QfX','phone':'wfwx4DE60lLfvMe3rq8l','address':'1PUJUF8rqsvNZ01r1MTm','about':'mnOiuwauOfuXsk1rCtVs','registered':'2s0f46yaMPDX1AHlLFCb','latitude':62.18822107193391,'longitude':109.15987998654879,'tags':['L7kXYe3uBe','70N0p2Jqjq','xh6xqeS1yy'],'friends':[{'id':'7070','name':'gGXjHHzQqKgJEpAvUOVOjxuyXFduFp'},{'id':'8169','name':'UOmyYTRGXMxiLxfHkELzVvofjRNNxx'},{'id':'8270','name':'IuSQMIaXZpvICnXqRzAOJSVUaouKMl'}],'greeting':'ZWRyEBGWqJWypZSTksWA','favoriteFruit':'rDY6clLec1aYCRyNLkrD'},{'_id':'26940351841424217167','index':1566640172,'guid':'BxtJvyAZZsSRhtmV1P8L','isActive':true,'balance':'SFD5josR9igGq7KCsqcI','picture':'epNdpV8X0R4VdCZBK00AzEUu85bjA4hGf0gOgi6IjIvH4VFLIalA55em0ybXzn1otAIcMjgjJbLDGIOLQxLEHbZJrkd8CwDGH8hY','age':22,'eyeColor':'QqxdEfF7MOqhSCgoKK3d','name':'JOVxUjmoT7qRMjsWf727','gender':'5Io5GdJJ4DLbw8wBWPSb','company':'LDekD1ii98K60EmsYAmN','email':'hnYopbJRBgJIxmCwgkj8','phone':'eJ2bMMaGsMkhNVoV8qgW','address':'VFqiR8Rk6Gg24fwfukGO','about':'JNnYqS1exWisaOYKcPpd','registered':'2OuXyGUbf3p0YrmI5JcM','latitude':10.846352869686992,'longitude':120.42178012978727,'tags':['0lgGrqA18s','Yq5ar8flHm','xiXbljsZZx'],'friends':[{'id':'9380','name':'TxJQNKSEdSydOTkoJtUcJeVuyReEZw'},{'id':'6806','name':'fqFfgEEoaCdKUAfrVaqhetumkWoFNG'},{'id':'9265','name':'cLwrWKhKhfIcDOubbyEboSNLMxZQyS'}],'greeting':'xZn6GCm10wnzber3lOQD','favoriteFruit':'CU1Z5dznm3riUawdUaCT'},{'_id':'41430880476250590138','index':1118839397,'guid':'p1NBt3ur6ZzE9Su1w2ru','isActive':true,'balance':'vhPWJ9lmpf1vmNKm2fwp','picture':'q7yE8U8qvS4PuGkvBQEmVd9c9D6Z7s3fekFPsbuP9BhcV2u7MKpokPNAkKIzBNKYUYMrTNPQ4mPVMP7IneFu4T4sWPyIVjeDXdmX','age':21,'eyeColor':'AO9reMJq6MsPuGWe5NiH','name':'sAz9vZubYh0gPj7vRAeB','gender':'ghMnslgc1w8qxaK8DkWK','company':'74uR3Zh5aLLdSn6d5J6e','email':'i9jjlpLY9H9J9vneAKCm','phone':'qfDEnFfLDfl4SUpgOpIo','address':'Dcnn5LjsmNVskWVIgjH3','about':'SrmE8H834IsaCZt3oCSb','registered':'T191av9CXq1MRgv6dL90','latitude':88.34134180882214,'longitude':132.3171805175242,'tags':['R26c9NaPfD','kpcuMwOX0m','XIg2tvR1yZ'],'friends':[{'id':'193','name':'XBfMgOusjqOHXBjKKEtYwXzrvjcMLe'},{'id':'3554','name':'YIwmfOloGELJgubqQeHoMLStumYAsc'},{'id':'5295','name':'JsFAzIEMqjIzKCfMKgHPdogBogIfDa'}],'greeting':'hmtlNuViYOQsGfD7fbA6','favoriteFruit':'Q5YzdWQHCkJJHJxo1DvQ'},{'_id':'68957546236262296330','index':242733771,'guid':'ucrZ4wyIPEiY2JTnX3w2','isActive':true,'balance':'TSz7B8MFM3QAvy86TEJb','picture':'PhW8p7WeJ3IURJ1yyT6oQmgC7J7ZbnJoRXfP0JwMmcDt53vOVwKGHDdRdEYY8CurFnYckFpOfXt6MXiJ5OZnBecnMXM3R3t0wk07','age':80,'eyeColor':'y4e5nc7L0Fj0OFNIzAag','name':'y7eohLrzNxbCI3jXForS','gender':'d30gvY4tvT8p1OkyHWFD','company':'QqIO3qolgrYrH66fdz0m','email':'1fKZtpS8PRIrFhZog06y','phone':'vNN6PMps1zQSLdRgZlVU','address':'Zx0BOfcIEI0AR4UwgcUt','about':'vgkxay9WROrdmj9XGaZR','registered':'sVIhpBpHN46dA3k2Zwa1','latitude':73.86599521171273,'longitude':45.83759451583899,'tags':['jmyQP4cCqt','y5Q6uPGmDu','yufa57dMsu'],'friends':[{'id':'7375','name':'DPXqEdBpkzjYtUBQFfxlLKeVAsJapv'},{'id':'3127','name':'TttwBlFtsICzVgaXVujhXOcVxiPMkL'},{'id':'9053','name':'LZrhcCLaxaArPHBujVnVfItkHgVviT'}],'greeting':'YTNdxyOBWrwpNsavgOgL','favoriteFruit':'t2SfuUCm3NOSpQTbQ5xf'}]}".replace('\'', '"').getBytes();
//        input = "['FUhvyUbkGNdVKtg8vtM3', 'Kzf7xZZNMU2fPdVA9cI5', 'FUhvyUbkGNdVKtg8vtM3']".replace('\'', '"').getBytes();
//        input = "{'name': 'FUhvyUbkGNdVKtg8vtM3', 'gender': 'Kzf7xZZNMU2fPdVA9cI5', 'company': 'FUhvyUbkGNdVKtg8vtM3'}".replace('\'', '"').getBytes();
        typeLiteral = new TypeLiteral<Users>() {
        };
    }

    @Benchmark
    public void asoniter(Blackhole bh) throws Exception {
        iter.reset(input);
        bh.consume(iter.read(typeLiteral));
//        throw new RuntimeException("");
    }

    @Benchmark
    public void dsljson(Blackhole bh) throws Exception {
//        JsonReader jsonReader = dslJson.newReader(input, input.length);
//        jsonReader.getNextToken();
//        jsonReader.getNextToken();
//        throw new RuntimeException("!!!" + StringConverter.deserializeNullableCollection(jsonReader));
//        bh.consume(StringConverter.deserializeNullableCollection(jsonReader));
        bh.consume(dslJson.deserialize(Users.class, input, input.length));
//        throw new RuntimeException("");
    }

    public static void main(String[] args) throws Exception {
        Main.main(args);
    }
}
